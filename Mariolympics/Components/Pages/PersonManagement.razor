@page "/people"

@inject PersonRepository PersonRepository

<h3>People</h3>

<table class="table">
    <thead>
    <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th></th>
    </tr>
    </thead>
    <tbody>
    @foreach (var person in Persons)
    {
        <tr>
            <td>@person.FirstName</td>
            <td>@person.LastName</td>
            <td>@person.Email</td>
            <td>@person.Phone</td>
            <td class="text-center">
                <button class="btn btn-danger btn-sm my-auto" @onclick="() => RemovePerson(person.Id)">
                    <Icon Name="IconName.Dash"></Icon>
                </button>
            </td>
        </tr>
    }
    <tr>
        <td><input class="form-control" @bind="NewPerson.FirstName" /></td>
        <td><input class="form-control" @bind="NewPerson.LastName" /></td>
        <td><input class="form-control" @bind="NewPerson.Email" /></td>
        <td><input class="form-control" @bind="NewPerson.Phone" /></td>
        <td class="text-center">
            <button class="btn btn-primary btn-sm my-auto" @onclick="AddPerson">
                <Icon Name="IconName.Plus"></Icon>
            </button>
        </td>
    </tr>
    </tbody>
</table>

@code {
    private List<Person> Persons { get; set; } = [];

    private Person NewPerson { get; set; } = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);

        if (firstRender)
        {
            Persons = await PersonRepository.GetPersonsAsync();
            StateHasChanged();
        }
    }

    private async Task AddPerson()
    {
        await PersonRepository.AddPersonAsync(NewPerson);
        NewPerson = new Person();
        Persons = await PersonRepository.GetPersonsAsync();
    }

    private async Task RemovePerson(int id)
    {
        var person = Persons.FirstOrDefault(x => x.Id == id);
        await PersonRepository.RemovePersonAsync(person);
        Persons = await PersonRepository.GetPersonsAsync();
    }
}

