@page "/bracket-test"

@using Mariolympics.Models

<PageTitle>Tournament Bracket Test</PageTitle>

<h2>Tournament Bracket Generator</h2>

<div class="row mb-3">
    <div class="col-md-4">
        <label for="gameSelect" class="form-label">Game/Sport:</label>
        <select @bind="SelectedGame" class="form-select" id="gameSelect">
            <option value="Mario Kart">Mario Kart</option>
            <option value="Super Smash Bros">Super Smash Bros</option>
            <option value="Mario Party">Mario Party</option>
            <option value="Tennis">Tennis</option>
            <option value="Custom Tournament">Custom Tournament</option>
        </select>
    </div>
    <div class="col-md-8">
        <label class="form-label">&nbsp;</label>
        <div>
            <button class="btn btn-primary" @onclick="GenerateBracket">Generate Bracket</button>
            <button class="btn btn-outline-secondary ms-2" @onclick="ClearBracket">Clear Bracket</button>
            @if (CurrentBracket.Rounds.Any())
            {
                <button class="btn btn-outline-warning ms-2" @onclick="ResetBracket" title="Reset all match results to original bracket state">Reset Results</button>
            }
        </div>
    </div>
</div>

<TournamentBracket 
    Bracket="@CurrentBracket" 
    Players="@Players" 
    ShowPlayerList="true"
    AllowSwap="true"
    OnWinnerSelected="@HandleWinnerSelected"
    OnPlayersSwapped="@HandlePlayersSwapped" />

@code {
    private Bracket CurrentBracket { get; set; } = new Bracket();
    private string SelectedGame { get; set; } = "Mario Kart";
    private List<Player> Players { get; set; } = new List<Player>
    {
        new Player { Person = new Person { FirstName = "Mac", LastName = "Ens" } },
        new Player { Person = new Person { FirstName = "Riley", LastName = "Fehr" } },
        new Player { Person = new Person { FirstName = "Ian", LastName = "Lane" } },
        new Player { Person = new Person { FirstName = "Luc", LastName = "Ens" } },
        new Player { Person = new Person { FirstName = "Josh", LastName = "Froese" } },
        new Player { Person = new Person { FirstName = "Reece", LastName = "Main" } },
        new Player { Person = new Person { FirstName = "Brett", LastName = "Janzen" } }
    };

    private void ClearBracket()
    {
        CurrentBracket = new Bracket();
    }

    private void ResetBracket()
    {
        CurrentBracket.Reset();
    }

    private void GenerateBracket()
    {
        CurrentBracket = new Bracket
        {
            Game = SelectedGame
        };
        
        CurrentBracket.GenerateBracket(Players);
    }

    private void HandleWinnerSelected((Match match, Player winner) data)
    {
        // Optional: Add any additional logic when a winner is selected
        // For example, logging, notifications, or saving to database
        StateHasChanged();
    }

    private void HandlePlayersSwapped(Match match)
    {
        // Optional: Add any additional logic when players are swapped
        // For example, logging or tracking changes
        StateHasChanged();
    }
}